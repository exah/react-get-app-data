<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [Getting Data][1]
    -   [withData][2]
        -   [Props][3]
        -   [Provided props][4]
        -   [Parameters][5]
        -   [Examples][6]
-   [Server-Side Rendering (SSR)][7]
    -   [getInitialData][8]
        -   [Parameters][9]
        -   [Examples][10]
    -   [hydrateData][11]
        -   [Parameters][12]
        -   [Examples][13]
-   [Optional][14]
    -   [createDataStore][15]
        -   [Parameters][16]
        -   [Examples][17]
    -   [DataProvider][18]
        -   [Props][19]
        -   [Examples][20]
-   [Types][21]
    -   [GetDataFn][22]
        -   [Examples][23]
    -   [ShouldDataUpdateFn][24]
        -   [Examples][25]
    -   [MergePropsFn][26]

## Getting Data




### withData

Higher-Order Component for getting async data for initial component props and in subsequent updates.

#### Props

-   Anything required for your [GetDataFn][22] or custom [ShouldDataUpdateFn][24]

#### Provided props

-   `...props` — All props passed to `withData` from parent
-   `isLoading: boolean` — Status of `getData` promise (server: `false`)
-   `error: Error | null` — Error rejected with promise (server: `null`) <br>
    On server you may want to return custom `{ error }` inside `Promise.catch` to show errors inside component. Otherwise component will try to request data again on client after mount.
-   `...result` — Everything returned in `getData` will be passed as props

See [GetDataFn][22] and [MergePropsFn][26].

#### Parameters

-   `getData` **[GetDataFn][27]** — Function that returns promise with props for wrapped component
-   `shouldDataUpdate` **[ShouldDataUpdateFn][28]**  (optional, default `defaultShouldDataUpdate`)
-   `mergeProps` **[MergePropsFn][29]**  (optional, default `defaultMergeProps`)

#### Examples

```javascript
const Comp = withData(getData?, shouldDataUpdate?, mergeProps?)(TargetComp)
```

```javascript
import { withData } from 'react-universal-data'

const Page = ({ message }) => (
  <div>
    {message}
  </div>
)

export default withData((contextAndProps, prevData) =>
  Promise.resolve({ message: 'ok' })
)(Page)
```

```javascript
import React from 'react'
import { withData } from 'react-universal-data'

class Page extends React.Component {
  // Same as `withData` first argument
  static async getData (contextAndProps, prevData) {
    return {
      name: 'John'
    }
  }
  render () {
    return (
      <div>
        Hello {this.props.name}!
      </div>
    )
  }
}

export default withData()(Page)
```

Returns **HOC** — [Higher-Order Component][30]

## Server-Side Rendering (SSR)




### getInitialData

**Server**: Request app data from all `withData` wrapped components
by walking deep inside React element [`tree`][31].

#### Parameters

-   `rootElement` **ReactElement&lt;any>** — Your app root React element
-   `serverContext` **[Object][32]** — Can be used to provide additional data to `GetDataFn` (like `req`, `res` from an `express` middleware).
-   `dataStore` **DataStoreType**  (optional, default `defaultDataStore`)

#### Examples

```javascript
import React from 'react'
import { renderToString } from 'react-dom/server'
import { getInitialData } from 'react-universal-data'
import { html } from 'common-tags'

import App from './app'

export default () => (req, res) => {
  const appElement = (<App />)

  getInitialData(appElement, { req, res })
    .then((initialData) => {
      res.send(html`
        <!DOCTYPE html>
        <html>
          <body>
            <div id="app">${renderToString(appElement)}</div>
            <script>
              (function () {
                window._ssr = ${JSON.stringify({ initialData })};
              })();
            </script>
            <script src="/client.js"></script>
          </body>
        </html>
      `)
    })
    .catch((error) => {
      console.error(error)
      res.status(500)
      res.send(`Error: ${error.message}`)
    })
}
```

Returns **[Promise][33]&lt;[Object][32]>** 

### hydrateData

**Client**: Hydrates SSR state from `getInitialData`.
Must be used before rendering App root component.

#### Parameters

-   `data` **[Object][32]** 

#### Examples

```javascript
import React from 'react'
import ReactDOM from 'react-dom'
import { hydrateData } from 'react-universal-data'
import App from './app'

// Get server state
const { initialData } = (window._ssr || {})

// Restore app state
hydrateData(initialData)

// Render app
ReactDOM.hydrate((
  <App />
), document.getElementById('app'))
```

Returns **void** 

## Optional

`DataStore` customization.
Useful only when dealing with multiple `react-universal-data` instances or when you need to directly access `dataStore` methods.


### createDataStore

Create custom `dataStore`, that can be provided to [DataProvider][18] and [getInitialData][8].

#### Parameters

-   `initialData` **[Object][32]**  (optional, default `{}`)

#### Examples

```javascript
// client.js

import React from 'react'
import ReactDOM from 'react-dom'
import { createDataStore, DataProvider } from 'react-universal-data'
import App from './app'

const { initialData } = (window._ssr || {})

const myDataStore = createDataStore(intialData)

ReactDOM.render((
  <DataProvider value={myDataStore}>
    <App />
  </DataProvider>
), document.getElementById('app'))
```

```javascript
// server.js

import { html } from 'common-tags'
import React from 'react'
import { renderToString } from 'react-dom/server'
import { getInitialData, createDataStore, DataProvider } from 'react-universal-data'
import App from './app'

export default () => (req, res) => {
  const myDataStore = createDataStore()

  const appElement = (
    <DataProvider value={myDataStore}>
      <App />
    </DataProvider>
  )

  getInitialData(appElement, { req, res }, myDataStore)
    .then((initialData) => {
      res.send(html`
        <!DOCTYPE html>
        <html>
          <body>
            <div id="app">${renderToString(appElement)}</div>
            <script>
              (function () {
                window._ssr = ${JSON.stringify({ initialData })};
              })();
            </script>
            <script src="/client.js"></script>
          </body>
        </html>
      `)
    })
    .catch() // Somehow handle errors
}
```

Returns **DataStoreType** 

### DataProvider

Provides `dataStore` created with [createDataStore][15] to [withData][2] components using [React Context][34].

#### Props

-   `value` **DataStoreType**

#### Examples

```javascript
import React from 'react'
import { createDataStore, DataProvider } from 'react-universal-data'
import App from './app'

const appElement = (
  <DataProvider value={createDataStore()}>
    <App />
  </DataProvider>
)
```

## Types




### GetDataFn

Function that returns Promise with props for `withData` wrapped component.
First argument is **Object** with `isClient`, `isServer` flags, parent component props and context from `getInitialData`.

If returned value is `false`, `null` or `undefined`, component will use previous data in state, also
in `getInitialData` `false` value will prevent requesting data inside that element tree.

Type: function (context: [Object][32], prevData: [Object][32]): [Promise][33]&lt;({} | \[] | [boolean][35] | null)>

#### Examples

```javascript
const getData = ({ isClient, isServer, ...parentProps }) =>
  Promise.resolve({ message: isServer ? 'server' : 'client' })

withData(getData)(Comp)

// SSR
// Comp props -> { message: 'server' }

// Client (after update)
// Comp props -> { message: 'client' }
```

```javascript
const getData = (contextProps, prevData) =>
  prevData // this is update
    ? Promise.resolve(null) // data in state will not update
    : Promise.resolve({ message: 'ok' })

withData(getData)(Comp)

// Comp props -> { message: 'ok' }
```

```javascript
const getData = (contextProps, prevData) =>
  Promise.resolve([ 1, 2, 3, 4 ]) // arrays will be passed as `data` prop

withData(getData)(Comp)

// Comp props -> { data: [ 1, 2, 3, 4 ] }
```

### ShouldDataUpdateFn

Function that checks if new data should be requested with `GetDataFn` when receiving new props.

By default it compares [React Router][36] [`match.params`][37], [`location.pathname`][38], `location.search` props. Also you can change `id` prop on component to indicate update.

```js
const defaultShouldDataUpdate = (prev, next) => {
  if (prev.match && prev.location) {
    return !(
      shallowEqual(prev.match.params, next.match.params) &&
      prev.location.pathname === next.location.pathname &&
      prev.location.search === next.location.search
    )
  }

  return prev.id !== next.id
}
```

Type: function (prev: Props, next: Props): [boolean][35]

#### Examples

```javascript
// update data only on lang change
withData(
  (props) => api.getPage({ slug: props.slug, lang: props.lang }),
  (prevProps, nextProps) => prevProps.lang !== nextProps.lang
)
```

```javascript
// request data once
withData(
  () => api.getSomeStuff(),
  () => false
)
```

```javascript
// Default update behaviour
const Comp = withData(() => api.getSomeStuff())(TargetComp)

// Get data on first render
<Comp id={1} />

// Updates because we changed `id` prop
<Comp id={2} />

// Nothing changed
<Comp id={2} />
```

### MergePropsFn

Merge parent props with `withData` internal state.

By default:

```js
const defaultMergeProps = ({ dataStore, ...props }, state) => ({
  ..props,
  isLoading: props.isLoading || state.isLoading,
  error: state.error || props.error || null,
  ...(Array.isArray(state.data) ? { data: state.data } : state.data)
})
```

Type: function (props: Props, state: State): Props

[1]: #getting-data

[2]: #withdata

[3]: #props

[4]: #provided-props

[5]: #parameters

[6]: #examples

[7]: #server-side-rendering-ssr

[8]: #getinitialdata

[9]: #parameters-1

[10]: #examples-1

[11]: #hydratedata

[12]: #parameters-2

[13]: #examples-2

[14]: #optional

[15]: #createdatastore

[16]: #parameters-3

[17]: #examples-3

[18]: #dataprovider

[19]: #props-1

[20]: #examples-4

[21]: #types

[22]: #getdatafn

[23]: #examples-5

[24]: #shoulddataupdatefn

[25]: #examples-6

[26]: #mergepropsfn

[27]: #getdatafn

[28]: #shoulddataupdatefn

[29]: #mergepropsfn

[30]: https://reactjs.org/docs/higher-order-components.html

[31]: https://github.com/ctrlplusb/react-tree-walker/

[32]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[33]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[34]: http://reactjs.org/docs/context.html

[35]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[36]: https://reacttraining.com/react-router

[37]: https://reacttraining.com/react-router/web/api/match

[38]: https://reacttraining.com/react-router/web/api/location
